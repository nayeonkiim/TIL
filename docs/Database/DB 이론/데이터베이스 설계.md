---
id: DB2
title: 데이터베이스 설계
---

## 데이터베이스 설계 순서
- **요구 분석 -> 개념적 설계 -> 논리적 설계 -> 물리적 설계 -> 구현**

### 요구 분석
- 실제 세계에서 어떤 시스템을 구축할 것이지에 대한 요구사항을 수집한다.
- 수집된 정보를 바탕으로 요구 조건 명세를 작성한다.

### 개념적 설계
- E-R 다이아그램으로 작성한다.
- DBMS에 독립적이 개념 스키마를 작성한다.

### 논리적 설계
- 관계형 데이터베이스라면 테이블을 설계하는 단계이다.

### 물리적 설계
- 물리적 저장장치에 저장할 수 있는 물리적 구조의 데이터베이스로 변환하는 단계이다.

## 예제를 통해 데이터베이스 설계
- _아래의 예제는 [데이터베이스 개론](http://www.yes24.com/Product/Goods/9194489?scode=029) 책에 기재된 예제문제 입니다._

- 요구 분석
    - 한빛 항공사에 회원으로 가입하려면 회원아이디, 비밀번호, 성명, 신용카드 정보를 입력해야 한다.
    - 회원의 신용카드 정보는 여러 개를 저장할 수 있는데, 세부적으로는 신용카드번호, 유효기간을 저장할 수 있다.
    - 한빛 항공사에서는 보유한 비행기에 대해 비행기번호, 출발날짜, 출발시간 정보를 저장하고 있다.
    - 한빛 항공사에서는 좌석에 대한 좌석번호, 등급 정보를 저장하고 있다.
    - 회원은 좌석을 예약하는데, 회원 한 명은 좌석을 하나만 예약할 수 있고, 한 좌석은 회원 한명만 예약할 수 있다.
    - 비행기에는 좌석이 존재하는데, 비행기 하나에는 좌석이 여러 개 존재할 수 있고 한 좌석은 반드시 하나의 비행기에만 존재해야 한다. 그리고 좌석은 비행기가 없으면 의미가 없다. 

- 개념적 설계로 E-R 다이어그램 만들기
    - 1) 개체(Entity)와 속성(attribute) 추출<br/><br/>
        - |개체|속성|
          |------|-------------------------------|
          |회원|회원아이디, 비밀번호, 성명, 신용카드|
          |신용카드|신용카드번호, 유효기간|
          |비행기|비행기번호, 출발날짜, 출발시간 정보|
          |좌석|좌석번호, 등급|
    - 2) 개체 간의 관계 추출
        - 일대일(1:1), 일대다(1:N), 다대다(N:M)
        - 관계 : 선택적인 관계, 필수적인 관계<br/>

        - 관계가 필수인지 선택적인지 관계 파악 방법
            - 필수적 : [A : B] 관계에서 집합 B의 모든 개체가 [A : B] 관계에 참여
            - 선택적 : [A : B] 관계에서 집합 B의 일부 개체만 [A : B] 관계에 참여
                - ex [회원 : 주문] 회원(선택), 주문(필수)<br/>
                    회원은 여러 주문을 할 수 있고 한 주문은 한 회원에 의해 주문된다.
        
        - 개체 간의 관계 추출 결과
            - |관계|관계에 참여하는 개체|
            |------|-------------------------------------------------|
            |보유|회원(선택): 한 회원은 여러 신용카드를 가질 수 있다.<br/>신용카드(필수) : 한 신용카드는 한 회원이 보유한다. -> 1:N
            |예약|회원(선택) : 한 회원은 여러 비행기를 예약할 수 있다.<br/>비행기(필수) : 한 비행기에 여러 회원이 예약될 수 있다. -> N:M
            |존재|비행기(필수) : 비행기 하나에는 좌석이 여러개 존재한다.<br/>좌석(필수) : 한 좌석은 하나의 비행기에만 존재해야 한다. -> 1:N

            - 1:N, 1:1 관계는 Foreign key로 표현한다.
                - 회원 : 신용카드 = 1 : N 이므로 신용카드 테이블에 FK로 
                회원 테이블의 Primary key인 MEMBER_ID 필드가 있어야 한다.
            - N:M 관계는 릴레이션으로 변환한다.
                - 회원 : 비행기 = N:M 이므로 관계 릴레이션을 생성한다면
                관계 릴레이션에선 개별의 기본키와 외래키는 회원의 PK인 회원번호, 
                비행기의 PK인 비행기 번호가 된다.

        - 분석한 내용으로 ERD 생성하기
            - draw.io 로 사용하면 생성 가능하다. draw.io는 IE 표기법을 사용한다.<br/>
            <img src="/static/img/20.JPG" width="700px" height="450px" title="table1" alt="ERD생성"></img><br/>     

    - 테이블 생성 및 물리적 스키마 구현
        - MySQL Workbench 프로그램을 사용하여 물리적 스키마 생성 가능하다.
        - 아래와 같이 만들 수 있다.<br/>
        <img src="/static/img/21.JPG" width="600px" height="450px" title="table1" alt="ERD생성"></img><br/>     

        ```Schema 항공사```
        ```sql
        CREATE TABLE IF NOT EXISTS `항공사`.`회원` (
        `회원아이디` INT NOT NULL,
        `성명` VARCHAR(45) NULL,
        `비밀번호` VARCHAR(45) NULL,
        PRIMARY KEY (`회원아이디`))
        ENGINE = InnoDB;
        ```
        ```sql
        CREATE TABLE IF NOT EXISTS `항공사`.`비행기` (
        `비행기번호` INT NOT NULL,
        `출발시간` DATETIME NULL,
        `출발날짜` DATETIME NULL,
        PRIMARY KEY (`비행기번호`))
        ENGINE = InnoDB;
        ```
        
### 트랜잭션
- INSERT, UPDATE 명령으로 데이터를 추가, 갱신할 때도 트랜잭션 기능을 사용한다.
- 만약 INSERT 명령이 특정 원인에 의해 에러가 발생한 경우 트랜잭션의 기능을 사용하지 않으면 DELETE 명령을 통해 INSERT문을 삭제 해야 한다.
- 트랜잭션을 사용해서 데이터를 추가한다면 에러가 발생해도 트랜잭션을 **롤백**해서 종료할 수 있다.
- 트랜잭션을 종료하기 위해서는 내용을 변경한 후 적용하는 '커밋'과 적용하지 않는 '롤백' 중 한 명령을 실행해야 한다.
- **롤백(rollback)** : 트랜잭션으로 인한 하나의 묶음 처리가 시작되기 이전의 상태로 되돌린다.
- **커밋(commit)** : 트랜잭션의 처리 과정을 데이터베이스에 반영, 변경된 내용을 모두 영구 저장한다.
    - 자동 커밋 : 트랜잭션을 사용해서 데이터를 추가할 때는 자동 커밋을 꺼야 한다. 트랜잭션 시작할 때는 `START TRANSACTION`
- 세트로 실행하고 싶은 SQL 명령을 하나의 트랜잭션 내에서 묶어서 실행하면 된다.

```sql
//MySQL
START TRANSACTION
INSERT INTO 주문 VALUES (4, '2021-01-21', 1);
INSERT INTO 주문상품 VALUES (4, '0003', 1);
INSERT INTO 주문상품 VALUES (4, '0004', 2);
COMMIT;
```


- 참고
    - https://advenoh.tistory.com/31
