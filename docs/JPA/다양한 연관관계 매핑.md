---
id: JPA7
title: 다양한 연관관계 매핑
---
_[자바 ORM 표준 JPA 프로그래밍 - 기본편](https://www.inflearn.com/course/ORM-JPA-Basic)을 보고 학습한 내용을 정리한 것입니다._


## 다양한 연관관계 매핑

* 공부 목차
    - 연관관계 매핑 시 고려사항 3가지
    - 다대일 [N:1]
    - 일대다 [1:N]
    - 일대일 [1:1]
    - 다대다 [N:N]

### 연관관계 매핑시 고려사항 3가지
- 다중성 -> 다대일 @ManyToOne, 일대다 @OneToMany, 일대일 @OneToOne, 다대다 @ManyToMany
    - 데이터베이스 관점에서의 다중성을 기준으로 고민하기.
- 단반향,양방향
    - 테이블 : 외래키 하나로 양쪽 조인 가능.
    - 객체 : 한쪽만 참조 필드가 있으면 단방향, 양쪽이 서로 참조면 양방향
- 연관관계의 주인
    - 객체 양방향 관계는 참조가 2군데 이다. 둘 중 테이블의 외래 키를 관리할 곳을 지정해야 함.
    - 연관관계의 주인 : **외래 키를 관리하는 참조**
    - 주인의 반대편 : 단순 조회만 가능

### 다대일 N:1
- '다' 이 연관관계 주인이다.
- '다' 에서 외래키를 관리하겠다.<br/><br/>

- 다대일 단방향 (가장 많이 사용)
    - **항상 다 에 외래키가 존재해야 한다.**
    - 외래키를 기준으로 연관된 참조를 매핑하면 된다.
        - Member 객체의 Team team 참조와 MEMBER 테이블의 TEAM_ID 연관관계 매핑
     <img src="/img/13.JPG" width="400px" height="250px" title="table1" alt="다대일"></img><br/>

    * Member 
        - Member 객체에만 Team 참조 둔다.
        ```
        @Entity
        @Getter @Setter
        public class Member {

            @Id
            @GeneratedValue
            @Column(name = "MEMBER_ID")
            private Long id;

            @Column(name = "USERNAME")
            private String name;

            @ManyToOne
            @JoinColumn(name = "TEAM_ID")
            private Team team;
        ```

    * Team

        ```
        @Entity
        @Getter @Setter
        public class Team {

            @Id @GeneratedValue
            @Column(name = "TEAM_ID")
            private Long id;
            private String name;
        }
        ```
- 다대일 양방향
    - 테이블은 단방향 매핑과 동일하다.
    - 양쪽에 모두 참조를 넣어준다.

    <img src="/img/14.JPG" width="400px" height="250px" title="table1" alt="다대일"></img><br/>

    * Member 
        - Member 객체에만 Team 참조 둔다.
        ```
        @Entity
        @Getter @Setter
        public class Member {

            @Id
            @GeneratedValue
            @Column(name = "MEMBER_ID")
            private Long id;

            @Column(name = "USERNAME")
            private String name;

            @ManyToOne
            @JoinColumn(name = "TEAM_ID")
            private Team team;
        ```

    * Team
        - Team 객체에 Member 참조를 둔다.
        ```
        @Entity
        @Getter @Setter
        public class Team {

            @Id @GeneratedValue
            @Column(name = "TEAM_ID")
            private Long id;
            private String name;

            @OneToMany(mappedBy = "team")
            private List<Member> members = new ArrayList<>();
        }
        ```


### 일대다 1:N
- '일' 이 연관관계 주인이다.
- '일' 에서 외래키를 관리하겠다.<br/><br/>


- 일대다 단방향
    - 객체 : Team 은 Member에 참조가 필요하고 <br/>
    Member는 Team에 참조가 필요없는 경우
    - 테이블 : 무조건 '다' 쪽에 외래키가 들어가야 한다.
        Team 이 연관관계 주인이 되어 외래키를 관리하는 경우인데
        그렇다면 Team에 List members 를 추가나 변경할 경우
        Member 테이블의 TEAM_ID를 변경시켜 줘야한다.
    <img src="/img/15.JPG" width="400px" height="250px" title="table1" alt="일대다"></img><br/>
